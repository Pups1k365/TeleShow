const express = require('express');
const fs = require('fs');
const app = express();

app.get('/save-image', (req, res) => {
  const urlParams = new URLSearchParams(req.query);
  const playerId = urlParams.get('player_id');
  const imageType = urlParams.get('type');
  const imageUrl = `https://www.brawltime.ninja/api/render/profile/${playerId}/${imageType}.png?background=cartoon_lobby.jpg`;

  // Сохраняем изображение на сервере
  const imageName = `player_${playerId}_${imageType}.png`;
  const imagePath = `images/${imageName}`;
  const file = fs.createWriteStream(imagePath);
  const request = https.get(imageUrl, function(response) {
    response.pipe(file);
  });

  // Отправляем HTML с изображением на новой странице
  const pageHtml = `
    <!DOCTYPE html>
    <html>
    <head>
      <title>Изображение игрока</title>
    </head>
    <body>
      <img src="${imagePath}" alt="Изображение игрока">
    </body>
    </html>
  `;
  res.send(pageHtml);
});

app.listen(3000, () => {
  console.log('Сервер запущен на порту 3000');
});
